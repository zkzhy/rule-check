# 任务：精简 LLM 入参并补齐 ATT&CK 选择能力

1. 实现 LLM 输入裁剪与上下文拼装
   - 将输入记录按白名单字段拼装为精简 context
   - 增加单字段与总长度预算，并对超长字段做截断策略
   - 增加覆盖测试：确保裁剪结果稳定、无 panic、长度符合预算
2. 实现基于 ATT&CK.csv 的两阶段候选集生成
   - 读取并缓存 ATT&CK.csv（路径可配置，默认仓库根目录）
   - 第一阶段：生成 tactic 候选列表（可配置范围）
   - 第二阶段：基于第一阶段选定的 tactic 生成 technique/sub 候选列表（Top-K，预算可配置）
   - 增加单测：给定固定输入文本，候选集生成结果可复现
3. 更新提示词模板以支持两阶段候选注入
   - 在模板中增加第一阶段/第二阶段候选集占位符与约束描述
   - 保持输出仍为严格 JSON，且禁止输出数值 ID
4. 调整 LLM 输出校验逻辑
   - 校验 LLM 输出的 tactic/technique/sub 必须命中候选集；不命中则按规则降级（例如清空 technique/sub 或回退仅 tactic）
   - 增加测试覆盖：命中/不命中/空候选集三种场景
5. 验证与工具链
   - 运行 `go test ./...` 与 `go build ./...`
   - 端到端跑一次工作流，确认输出中 tactic/technique/sub 更稳定，且提交阶段映射成功率提升
